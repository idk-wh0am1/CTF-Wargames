from pwn import *
import json
from base64 import b64decode
from tqdm import tqdm
from string import printable

context.log_level = 'error'
def get_data():
    global data
    
    io = remote("socket.cryptohack.org", 13370)
    io.recvline()
    io.sendline(json.dumps({
        'msg': 'request'    
    }).encode())
    ct = b64decode(
        json.loads(io.recvline())['ciphertext']
    )
    
    io.close()
    return ct

data = [set() for i in range(20)]
U = set(list(printable.encode()))

if __name__ == '__main__':
    for query in tqdm(range(5000)):
        try:
            ct = get_data()
            for i in range(20):
                data[i].add(ct[i])
            
            if query % 50 == 0:
                print([len(X) for X in data])
                flag = [(U - X).pop() for X in data]
                print(bytes(flag))
        except:
            pass

