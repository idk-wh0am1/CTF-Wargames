import time
from Crypto.Util.number import long_to_bytes
import hashlib
import json
from pwn import *

def generate_key():
    current_time = int(time.time())
    key = long_to_bytes(current_time)
    return hashlib.sha256(key).digest()

def encrypt(b):
    key = generate_key()
    assert len(b) <= len(key), "Data package too large to encrypt"
    ciphertext = b''
    for i in range(len(b)):
        ciphertext += bytes([b[i] ^ key[i]])
    return ciphertext

if __name__ == '__main__':
    io = remote("socket.cryptohack.org", 13372)
    io.recvline()
    
    io.sendline(json.dumps({
        'option': 'get_flag'
    }).encode())

    enc_flag = json.loads(io.recvline().decode())['encrypted_flag']
    flag = encrypt(bytes.fromhex(enc_flag))
    
    print("Flag: " + flag.decode())