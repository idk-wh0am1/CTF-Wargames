from sage.all import *
from pwn import *
from Crypto.Util.number import *
from gmpy2 import iroot
from math import prod


CS = []
NS = []
e = 65537

for i in range(300):
    print(i)
    io = remote("host3.dreamhack.games", 9668)
    io.sendline(b'256')
    Cs = []
    Ns = []
    for _ in range(256):
        io.recvuntil(f'Data {_ + 1}: '.encode())
        c, n = io.recvline().strip().decode().split(', ')
        Cs += [int(c[4:])]
        Ns += [int(n[4:])]
    NS += [ZZ(prod(Ns))]
    CS += [ZZ(crt(Cs, Ns))]
    io.close()

me = crt(CS, NS)
m, ok = iroot(me, e)
print(long_to_bytes(m))

with open("./modulus2.txt", "w") as f:
    f.write(str(prod(NS)))
with open("./ciphertext2.txt", "w") as f:
    f.write(str(me))