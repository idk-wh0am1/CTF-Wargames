from pwn import *
import randcrack

def verify(m):
    io.sendlineafter(b'> ', b'2'); io.recvuntil(b'please type this same: ')
    challenge = int(io.recvline().strip().decode()[1:-1]) 
    randn224   = challenge ^ 0xdeaddeadbeefbeefcafecafe13371337DEFACED0DEFACED0
    randlist = []

    while randn224:
        randlist += [randn224 & 0xffffffff]
        randn224 >>= 32
    
    io.sendlineafter(b'> ', str(m).encode())
    return randlist

io = remote("host3.dreamhack.games", 20076)

info("Cracking random...")
rc = randcrack.RandCrack()
for i in range(624 // 6):
    randlist = verify(1)
    for i32 in randlist:
        rc.submit(i32)

verify((rc.predict_getrandbits(32) | rc.predict_getrandbits(32) << 32 | rc.predict_getrandbits(32) << 64 | rc.predict_getrandbits(32) << 96 | rc.predict_getrandbits(32) << 128 | rc.predict_getrandbits(32) << 160) ^ 0xdeaddeadbeefbeefcafecafe13371337DEFACED0DEFACED0)

info("Playing game...")
money = 500
while money < 10000000000:
    success("Money: " + str(money))
    io.sendlineafter(b'> ', b'1')
    io.sendlineafter(b'? ', str(money).encode())
    io.sendlineafter(b'> ', str(rc.predict_getrandbits(32) % 5 + 1).encode())
    money *= 2

io.sendlineafter(b'> ', b'3')
io.interactive()