from Crypto.PublicKey import RSA
from factordb.factordb import FactorDB
from Crypto.Util.number import *
from base64 import b64decode

key = RSA.importKey(open("./pub.pem", "r").read())
n = key.n
e = key.e
c = open("./ciphertext.txt", "rb").read()

f = FactorDB(n); f.connect()
p, q = f.get_factor_list()
assert isPrime(p) and isPrime(q)

d = inverse(e, (p - 1)*(q - 1))
m = pow(bytes_to_long(c), d, n)

msg = long_to_bytes(m).split(b'\x00')[-1]
print(b64decode(msg))
