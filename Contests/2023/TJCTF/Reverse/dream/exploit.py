from sage.all import *
from pwn import *

def round1():
    #  35 * (((3 * v6) ^ 0xB6D8) % 0x521) % 0x5EB == 1370
    # (35 * ((5 * v7 % 0x1E61) | 0x457) - 5) % 0x3E8 == 80
    # v6 % v7 == 20202020 and v7 * v6 == 0x33D5D816326AADLL

    info("Solving round1...")
    
    v6, v7 = 0, 0
    for v6 in divisors(0x33D5D816326AAD):
        v7 = 0x33D5D816326AAD // v6
        if (35 * (((3 * v6) ^ 0xB6D8) % 0x521) % 0x5EB == 1370):
            if ((35 * ((5 * v7 % 0x1E61) | 0x457) - 5) % 0x3E8 == 80):
                if v6 % v7 == 20202020:
                    break

    return v6, v7

def round2():
    info("Solving round2...")
    
    target = 2351
    for n in range(3**12):
        foo = [int(x) for x in list(ZZ(n).str(3).zfill(12))]
        check = 0
        for i in range(12):
            if foo[i] == 0:
                check += 1
            elif foo[i] == 1:
                check *= check
            else:
                check += 22
        if check == target:
            return foo

operations = {
    0: b"ask her about some flags",
    1: b"ask her about her new album",
    2: b"ask her about her tour"
}

io = remote("tjc.tf", 31500)
io.sendlineafter(b"? ", b"sing")
io.sendlineafter(b": ", b"maybe I asked for too [many challenges to be written]")

v6, v7 = round1()
io.sendlineafter(b"? ", str(v6).encode())
io.sendlineafter(b"? ", str(v7).encode())

ans = round2()
for i in range(12):
    io.sendlineafter(b"? ", operations[ans[i]])

io.interactive()