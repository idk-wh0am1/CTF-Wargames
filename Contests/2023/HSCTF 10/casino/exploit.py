from pwn import *
from string import digits
from tqdm import tqdm

# start with token ee1d41422766e65b.51c27292fd597f93e9e01a
# -> decrypt: {"money": 2

context.log_level = 'error'
token = "ee1d41422766e65b.51c27292fd597f93e9e01a"

def bit_flipping(byte) -> bytes:
    io = remote("casino.hsctf.com", 1337)
    io.sendlineafter(b"> ", b"3")
    io.sendlineafter(b"> ", (token + hex(byte)[2:].zfill(2)).encode())
    res = eval(io.recvline().strip())
    return res[-1]

def get_flag():
    io = remote("casino.hsctf.com", 1337)
    io.sendlineafter(b"> ", b"3")
    io.sendlineafter(b"> ", token.encode())
    io.sendlineafter(b"> ", b"1")
    return io.recvline().strip().decode()

for stage in tqdm(range(10)):
    bit_flipped = bit_flipping(0)
    if stage != 9:
        token += hex(bit_flipped ^ ord('0'))[2:].zfill(2)
    else:
        token += hex(bit_flipped ^ ord('}'))[2:].zfill(2)
    print("Forge token: " + token)

flag = get_flag()
print("Flag: " + flag)